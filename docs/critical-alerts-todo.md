# Critical Alerts Re-enablement Guide

## Status
**PENDING APPLE APPROVAL** - Critical Alerts entitlement temporarily removed in commit 80f4029

## What Are Critical Alerts?
Critical Alerts bypass Do Not Disturb and silent mode, making them ideal for health/safety apps. They require special approval from Apple.

## Request Approval
Submit request at: https://developer.apple.com/contact/request/notifications-critical-alerts-entitlement

**Justification to provide:**
> Health tracking app for migraine/headache episodes. Critical alerts are needed to notify users to log their medication intake and track symptom severity at critical times, which is essential for proper medical record keeping and treatment effectiveness.

**App Details:**
- App Name: MigraLog
- Bundle ID: `com.eff3.app.headache-tracker`

## Steps to Re-enable After Approval

### 1. Enable in Apple Developer Portal
1. Go to **Certificates, Identifiers & Profiles** → **Identifiers**
2. Click on App ID: `com.eff3.app.headache-tracker`
3. Scroll to **Additional Capabilities**
4. Enable **Critical Alerts** (NOT "Critical Messaging" or "Time Sensitive Notifications")
5. Click **Save**

### 2. Update Provisioning Profile
1. Go to **Profiles**
2. Find your provisioning profile for MigraLog
3. Click **Edit** → **Generate** (or regenerate)
4. Alternatively, delete and recreate the profile to ensure it includes the new entitlement

### 3. Update app.json
Add back the entitlement configuration:

```json
"ios": {
  "supportsTablet": true,
  "bundleIdentifier": "com.eff3.app.headache-tracker",
  "buildNumber": "1",
  "infoPlist": {
    "ITSAppUsesNonExemptEncryption": false,
    "com.apple.developer.usernotifications.critical-alerts": 1
  },
  "entitlements": {
    "com.apple.developer.usernotifications.critical-alerts": true
  }
}
```

**Files to modify:**
- `/app/app.json` (lines 20-26 approximately)

### 4. Verify Entitlements File (Auto-generated)
The entitlements file at `/app/ios/MigraLog/MigraLog.entitlements` should automatically include:

```xml
<key>com.apple.developer.usernotifications.critical-alerts</key>
<true/>
```

This is auto-generated by Expo during prebuild, but verify it's present after running `npx expo prebuild --clean`.

### 5. Clear EAS Credentials Cache
```bash
cd app
eas credentials
```
- Select iOS
- Select your app identifier
- Remove provisioning profile
- Exit

### 6. Rebuild
```bash
cd app
eas build --platform ios
```

## Testing Critical Alerts
Once re-enabled, test that critical alerts work:
1. Enable Do Not Disturb on test device
2. Trigger a medication reminder notification
3. Verify notification sound/vibration occurs despite DND mode

## Related Files
- `app/app.json` - iOS entitlements configuration (app.json:20-26)
- `app/ios/MigraLog/MigraLog.entitlements` - Native entitlements (auto-generated)
- `app/src/services/notificationService.ts` - Notification implementation

## References
- Apple Developer Contact: https://developer.apple.com/contact/request/notifications-critical-alerts-entitlement
- Critical Alerts Documentation: https://developer.apple.com/documentation/usernotifications/unnotificationrequest/critical_alerts
